{"filter":false,"title":"api.js","tooltip":"/routes/api.js","undoManager":{"mark":100,"position":100,"stack":[[{"group":"doc","deltas":[{"start":{"row":14,"column":4},"end":{"row":14,"column":5},"action":"insert","lines":["d"]}]}],[{"group":"doc","deltas":[{"start":{"row":14,"column":5},"end":{"row":14,"column":6},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":14,"column":6},"end":{"row":14,"column":7},"action":"insert","lines":["l"]}]}],[{"group":"doc","deltas":[{"start":{"row":14,"column":7},"end":{"row":14,"column":8},"action":"insert","lines":["3"]}]}],[{"group":"doc","deltas":[{"start":{"row":14,"column":8},"end":{"row":14,"column":9},"action":"insert","lines":["d"]}]}],[{"group":"doc","deltas":[{"start":{"row":5,"column":46},"end":{"row":6,"column":0},"action":"insert","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":6,"column":0},"end":{"row":6,"column":46},"action":"insert","lines":["var Printer = require('../models/Printer.js');"]}]}],[{"group":"doc","deltas":[{"start":{"row":6,"column":39},"end":{"row":6,"column":40},"action":"remove","lines":["r"]}]}],[{"group":"doc","deltas":[{"start":{"row":6,"column":38},"end":{"row":6,"column":39},"action":"remove","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":6,"column":37},"end":{"row":6,"column":38},"action":"remove","lines":["t"]}]}],[{"group":"doc","deltas":[{"start":{"row":6,"column":36},"end":{"row":6,"column":37},"action":"remove","lines":["n"]}]}],[{"group":"doc","deltas":[{"start":{"row":6,"column":35},"end":{"row":6,"column":36},"action":"remove","lines":["i"]}]}],[{"group":"doc","deltas":[{"start":{"row":6,"column":34},"end":{"row":6,"column":35},"action":"remove","lines":["r"]}]}],[{"group":"doc","deltas":[{"start":{"row":6,"column":33},"end":{"row":6,"column":34},"action":"remove","lines":["P"]}]}],[{"group":"doc","deltas":[{"start":{"row":6,"column":33},"end":{"row":6,"column":34},"action":"insert","lines":["3"]}]}],[{"group":"doc","deltas":[{"start":{"row":6,"column":34},"end":{"row":6,"column":35},"action":"insert","lines":["d"]}]}],[{"group":"doc","deltas":[{"start":{"row":6,"column":35},"end":{"row":6,"column":36},"action":"insert","lines":["m"]}]}],[{"group":"doc","deltas":[{"start":{"row":6,"column":36},"end":{"row":6,"column":37},"action":"insert","lines":["o"]}]}],[{"group":"doc","deltas":[{"start":{"row":6,"column":37},"end":{"row":6,"column":38},"action":"insert","lines":["d"]}]}],[{"group":"doc","deltas":[{"start":{"row":6,"column":38},"end":{"row":6,"column":39},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":6,"column":39},"end":{"row":6,"column":40},"action":"insert","lines":["l"]}]}],[{"group":"doc","deltas":[{"start":{"row":6,"column":4},"end":{"row":6,"column":11},"action":"remove","lines":["Printer"]},{"start":{"row":6,"column":4},"end":{"row":6,"column":5},"action":"insert","lines":["M"]}]}],[{"group":"doc","deltas":[{"start":{"row":6,"column":5},"end":{"row":6,"column":6},"action":"insert","lines":["o"]}]}],[{"group":"doc","deltas":[{"start":{"row":6,"column":6},"end":{"row":6,"column":7},"action":"insert","lines":["d"]}]}],[{"group":"doc","deltas":[{"start":{"row":6,"column":7},"end":{"row":6,"column":8},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":6,"column":8},"end":{"row":6,"column":9},"action":"insert","lines":["l"]}]}],[{"group":"doc","deltas":[{"start":{"row":6,"column":9},"end":{"row":6,"column":10},"action":"insert","lines":["3"]}]}],[{"group":"doc","deltas":[{"start":{"row":6,"column":10},"end":{"row":6,"column":11},"action":"insert","lines":["d"]}]}],[{"group":"doc","deltas":[{"start":{"row":12,"column":31},"end":{"row":13,"column":0},"action":"insert","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":13,"column":0},"end":{"row":14,"column":33},"action":"insert","lines":["var request = require('request');","var cheerio = require('cheerio');"]}]}],[{"group":"doc","deltas":[{"start":{"row":14,"column":33},"end":{"row":15,"column":0},"action":"insert","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":15,"column":0},"end":{"row":15,"column":29},"action":"insert","lines":["var async = require('async');"]}]}],[{"group":"doc","deltas":[{"start":{"row":23,"column":26},"end":{"row":23,"column":31},"action":"remove","lines":["Thing"]},{"start":{"row":23,"column":26},"end":{"row":23,"column":27},"action":"insert","lines":["M"]}]}],[{"group":"doc","deltas":[{"start":{"row":23,"column":27},"end":{"row":23,"column":28},"action":"insert","lines":["o"]}]}],[{"group":"doc","deltas":[{"start":{"row":23,"column":28},"end":{"row":23,"column":29},"action":"insert","lines":["d"]}]}],[{"group":"doc","deltas":[{"start":{"row":23,"column":29},"end":{"row":23,"column":30},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":23,"column":30},"end":{"row":23,"column":31},"action":"insert","lines":["l"]}]}],[{"group":"doc","deltas":[{"start":{"row":23,"column":31},"end":{"row":23,"column":32},"action":"insert","lines":["3"]}]}],[{"group":"doc","deltas":[{"start":{"row":23,"column":32},"end":{"row":23,"column":33},"action":"insert","lines":["d"]}]}],[{"group":"doc","deltas":[{"start":{"row":77,"column":1},"end":{"row":78,"column":0},"action":"insert","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":78,"column":0},"end":{"row":79,"column":0},"action":"insert","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":79,"column":0},"end":{"row":177,"column":1},"action":"insert","lines":["function _parseSTLString (stl) {","\tvar totalVol = 0;","\t// yes, this is the regular expression, matching the vertexes","\t// it was kind of tricky but it is fast and does the job","\tvar vertexes = stl.match(/facet\\s+normal\\s+([-+]?\\b(?:[0-9]*\\.)?[0-9]+(?:[eE][-+]?[0-9]+)?\\b)\\s+([-+]?\\b(?:[0-9]*\\.)?[0-9]+(?:[eE][-+]?[0-9]+)?\\b)\\s+([-+]?\\b(?:[0-9]*\\.)?[0-9]+(?:[eE][-+]?[0-9]+)?\\b)\\s+outer\\s+loop\\s+vertex\\s+([-+]?\\b(?:[0-9]*\\.)?[0-9]+(?:[eE][-+]?[0-9]+)?\\b)\\s+([-+]?\\b(?:[0-9]*\\.)?[0-9]+(?:[eE][-+]?[0-9]+)?\\b)\\s+([-+]?\\b(?:[0-9]*\\.)?[0-9]+(?:[eE][-+]?[0-9]+)?\\b)\\s+vertex\\s+([-+]?\\b(?:[0-9]*\\.)?[0-9]+(?:[eE][-+]?[0-9]+)?\\b)\\s+([-+]?\\b(?:[0-9]*\\.)?[0-9]+(?:[eE][-+]?[0-9]+)?\\b)\\s+([-+]?\\b(?:[0-9]*\\.)?[0-9]+(?:[eE][-+]?[0-9]+)?\\b)\\s+vertex\\s+([-+]?\\b(?:[0-9]*\\.)?[0-9]+(?:[eE][-+]?[0-9]+)?\\b)\\s+([-+]?\\b(?:[0-9]*\\.)?[0-9]+(?:[eE][-+]?[0-9]+)?\\b)\\s+([-+]?\\b(?:[0-9]*\\.)?[0-9]+(?:[eE][-+]?[0-9]+)?\\b)\\s+endloop\\s+endfacet/g);","  ","  if (vertexes) {","  ","\tvertexes.forEach(function (vert) {","\t\tvar preVertexHolder = new VertexHolder();","\t\tvert.match(/vertex\\s+([-+]?\\b(?:[0-9]*\\.)?[0-9]+(?:[eE][-+]?[0-9]+)?\\b)\\s+([-+]?\\b(?:[0-9]*\\.)?[0-9]+(?:[eE][-+]?[0-9]+)?\\b)\\s+([-+]?\\b(?:[0-9]*\\.)?[0-9]+(?:[eE][-+]?[0-9]+)?\\b)\\s/g).forEach(function (vertex, i) {","\t\t\tvar tempVertex = vertex.replace('vertex', '').match(/[-+]?[0-9]*\\.?[0-9]+/g);","\t\t\tvar preVertex = new Vertex(tempVertex[0],tempVertex[1],tempVertex[2]);","\t\t\tpreVertexHolder['vert'+(i+1)] = preVertex;","\t\t});","\t\tvar partVolume = _triangleVolume(preVertexHolder);","\t\ttotalVol += Number(partVolume);","\t});","\t","  }","","\tvar volumeTotal = Math.abs(totalVol)/1000;","\treturn {","\t\tvolume: volumeTotal, \t\t// cubic cm","\t\tweight: volumeTotal * 1.04\t// gm","\t}","}","","function Vertex (v1,v2,v3) {","\tthis.v1 = Number(v1);","\tthis.v2 = Number(v2);","\tthis.v3 = Number(v3);","}","","// Vertex Holder","function VertexHolder (vertex1,vertex2,vertex3) {","\tthis.vert1 = vertex1;","\tthis.vert2 = vertex2;","\tthis.vert3 = vertex3;","}","","// transforming a Node.js Buffer into a V8 array buffer","function _toArrayBuffer (buffer) {","\tvar ","\tab = new ArrayBuffer(buffer.length),","\tview = new Uint8Array(ab);","\t","\tfor (var i = 0; i < buffer.length; ++i) {","\t\tview[i] = buffer[i];","\t}","\treturn ab;","}","","// calculation of the triangle volume","// source: http://stackoverflow.com/questions/6518404/how-do-i-calculate-the-volume-of-an-object-stored-in-stl-files","function _triangleVolume (vertexHolder) {","\tvar ","\tv321 = Number(vertexHolder.vert3.v1 * vertexHolder.vert2.v2 * vertexHolder.vert1.v3),","\tv231 = Number(vertexHolder.vert2.v1 * vertexHolder.vert3.v2 * vertexHolder.vert1.v3),","\tv312 = Number(vertexHolder.vert3.v1 * vertexHolder.vert1.v2 * vertexHolder.vert2.v3),","\tv132 = Number(vertexHolder.vert1.v1 * vertexHolder.vert3.v2 * vertexHolder.vert2.v3),","\tv213 = Number(vertexHolder.vert2.v1 * vertexHolder.vert1.v2 * vertexHolder.vert3.v3),","\tv123 = Number(vertexHolder.vert1.v1 * vertexHolder.vert2.v2 * vertexHolder.vert3.v3);","\treturn Number(1.0/6.0)*(-v321 + v231 + v312 - v132 - v213 + v123);","}","","","// parsing an STL Binary File","// (borrowed some code from here: https://github.com/mrdoob/three.js/blob/master/examples/js/loaders/STLLoader.js)","function _parseSTLBinary (buf) {","\tbuf = _toArrayBuffer(buf);","","\tvar headerLength = 80;","\tvar dataOffset = 84;","\tvar faceLength = 12*4 + 2;","","\tvar le = true; // is little-endian","","\tvar dvTriangleCount = new DataView(buf, headerLength, 4);","\tvar numTriangles = dvTriangleCount.getUint32(0, le);","\tvar totalVol = 0;","","\tfor (var i = 0; i < numTriangles; i++) {","\t\tvar dv = new DataView(buf, dataOffset + i*faceLength, faceLength);","\t\tvar normal = new Vertex(dv.getFloat32(0, le), dv.getFloat32(4, le), dv.getFloat32(8, le));","\t\tvar vertHolder = new VertexHolder();","\t\tfor(var v = 3; v < 12; v+=3) {","\t\t\tvar vert = new Vertex(dv.getFloat32(v*4, le), dv.getFloat32((v+1)*4, le), dv.getFloat32( (v+2)*4, le ) );","\t\t\tvertHolder['vert'+(v/3)] = vert;","\t\t}","\t\ttotalVol += _triangleVolume(vertHolder);","\t}","","\tvar volumeTotal = Math.abs(totalVol)/1000;","\treturn {","\t\tvolume: volumeTotal,\t\t// cubic cm","\t\tweight: volumeTotal * 1.04\t// gm","\t};","}"]}]}],[{"group":"doc","deltas":[{"start":{"row":585,"column":3},"end":{"row":585,"column":10},"action":"remove","lines":["aterial"]},{"start":{"row":585,"column":3},"end":{"row":585,"column":4},"action":"insert","lines":["o"]}]}],[{"group":"doc","deltas":[{"start":{"row":585,"column":4},"end":{"row":585,"column":5},"action":"insert","lines":["d"]}]}],[{"group":"doc","deltas":[{"start":{"row":585,"column":5},"end":{"row":585,"column":6},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":585,"column":6},"end":{"row":585,"column":7},"action":"insert","lines":["l"]}]}],[{"group":"doc","deltas":[{"start":{"row":585,"column":7},"end":{"row":585,"column":8},"action":"insert","lines":["3"]}]}],[{"group":"doc","deltas":[{"start":{"row":585,"column":8},"end":{"row":585,"column":9},"action":"insert","lines":["d"]}]}],[{"group":"doc","deltas":[{"start":{"row":574,"column":5},"end":{"row":574,"column":12},"action":"remove","lines":["aterial"]},{"start":{"row":574,"column":5},"end":{"row":574,"column":6},"action":"insert","lines":["o"]}]}],[{"group":"doc","deltas":[{"start":{"row":574,"column":6},"end":{"row":574,"column":7},"action":"insert","lines":["d"]}]}],[{"group":"doc","deltas":[{"start":{"row":574,"column":7},"end":{"row":574,"column":8},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":574,"column":8},"end":{"row":574,"column":9},"action":"insert","lines":["l"]}]}],[{"group":"doc","deltas":[{"start":{"row":574,"column":9},"end":{"row":574,"column":10},"action":"insert","lines":["3"]}]}],[{"group":"doc","deltas":[{"start":{"row":574,"column":10},"end":{"row":574,"column":11},"action":"insert","lines":["d"]}]}],[{"group":"doc","deltas":[{"start":{"row":597,"column":0},"end":{"row":598,"column":0},"action":"insert","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":598,"column":0},"end":{"row":611,"column":3},"action":"insert","lines":["router.get('/models/:id', function(req, res) {","  Thing.findOne({id: req.params.id}, function(err, thng) {","      if (!err && thng) {","        console.log('thing found');","        Material.find({}, function(err, mtrls) {","            if (!err) res.render('model', {thng: thng, mtrls: mtrls});","        });","      } else {","        console.log('thing not found');","        thng ? console.log('error: ' + err) : thingiParse(req.params.id);","        res.end();","      }","  });","});"]}]}],[{"group":"doc","deltas":[{"start":{"row":599,"column":2},"end":{"row":599,"column":7},"action":"remove","lines":["Thing"]},{"start":{"row":599,"column":2},"end":{"row":599,"column":3},"action":"insert","lines":["M"]}]}],[{"group":"doc","deltas":[{"start":{"row":599,"column":3},"end":{"row":599,"column":4},"action":"insert","lines":["o"]}]}],[{"group":"doc","deltas":[{"start":{"row":599,"column":2},"end":{"row":599,"column":4},"action":"remove","lines":["Mo"]},{"start":{"row":599,"column":2},"end":{"row":599,"column":9},"action":"insert","lines":["Model3d"]}]}],[{"group":"doc","deltas":[{"start":{"row":603,"column":34},"end":{"row":603,"column":35},"action":"insert","lines":["3"]}]}],[{"group":"doc","deltas":[{"start":{"row":603,"column":35},"end":{"row":603,"column":36},"action":"insert","lines":["d"]}]}],[{"group":"doc","deltas":[{"start":{"row":602,"column":8},"end":{"row":604,"column":11},"action":"remove","lines":["Material.find({}, function(err, mtrls) {","            if (!err) res.render('3dmodel', {thng: thng, mtrls: mtrls});","        });"]}]}],[{"group":"doc","deltas":[{"start":{"row":602,"column":6},"end":{"row":602,"column":8},"action":"remove","lines":["  "]}]}],[{"group":"doc","deltas":[{"start":{"row":602,"column":4},"end":{"row":602,"column":6},"action":"remove","lines":["  "]}]}],[{"group":"doc","deltas":[{"start":{"row":602,"column":2},"end":{"row":602,"column":4},"action":"remove","lines":["  "]}]}],[{"group":"doc","deltas":[{"start":{"row":602,"column":0},"end":{"row":602,"column":2},"action":"remove","lines":["  "]}]}],[{"group":"doc","deltas":[{"start":{"row":601,"column":35},"end":{"row":602,"column":0},"action":"remove","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":202,"column":8},"end":{"row":202,"column":32},"action":"remove","lines":["req.isAuthenticated() ? "]}]}],[{"group":"doc","deltas":[{"start":{"row":202,"column":44},"end":{"row":202,"column":75},"action":"remove","lines":[" : res.redirect('/admin/login')"]}]}],[{"group":"doc","deltas":[{"start":{"row":574,"column":35},"end":{"row":574,"column":42},"action":"remove","lines":["materia"]},{"start":{"row":574,"column":35},"end":{"row":574,"column":36},"action":"insert","lines":["m"]}]}],[{"group":"doc","deltas":[{"start":{"row":574,"column":36},"end":{"row":574,"column":37},"action":"insert","lines":["o"]}]}],[{"group":"doc","deltas":[{"start":{"row":574,"column":37},"end":{"row":574,"column":38},"action":"insert","lines":["d"]}]}],[{"group":"doc","deltas":[{"start":{"row":574,"column":38},"end":{"row":574,"column":39},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":576,"column":57},"end":{"row":576,"column":64},"action":"remove","lines":["materia"]},{"start":{"row":576,"column":57},"end":{"row":576,"column":58},"action":"insert","lines":["m"]}]}],[{"group":"doc","deltas":[{"start":{"row":576,"column":58},"end":{"row":576,"column":59},"action":"insert","lines":["o"]}]}],[{"group":"doc","deltas":[{"start":{"row":576,"column":59},"end":{"row":576,"column":60},"action":"insert","lines":["d"]}]}],[{"group":"doc","deltas":[{"start":{"row":576,"column":60},"end":{"row":576,"column":61},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":585,"column":49},"end":{"row":585,"column":56},"action":"remove","lines":["aterial"]},{"start":{"row":585,"column":49},"end":{"row":585,"column":50},"action":"insert","lines":["o"]}]}],[{"group":"doc","deltas":[{"start":{"row":585,"column":50},"end":{"row":585,"column":51},"action":"insert","lines":["d"]}]}],[{"group":"doc","deltas":[{"start":{"row":585,"column":51},"end":{"row":585,"column":52},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":585,"column":52},"end":{"row":585,"column":53},"action":"insert","lines":["l"]}]}],[{"group":"doc","deltas":[{"start":{"row":588,"column":36},"end":{"row":588,"column":43},"action":"remove","lines":["aterial"]},{"start":{"row":588,"column":36},"end":{"row":588,"column":37},"action":"insert","lines":["o"]}]}],[{"group":"doc","deltas":[{"start":{"row":588,"column":37},"end":{"row":588,"column":38},"action":"insert","lines":["d"]}]}],[{"group":"doc","deltas":[{"start":{"row":588,"column":38},"end":{"row":588,"column":39},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":588,"column":39},"end":{"row":588,"column":40},"action":"insert","lines":["l"]}]}],[{"group":"doc","deltas":[{"start":{"row":586,"column":17},"end":{"row":586,"column":24},"action":"remove","lines":["aterial"]},{"start":{"row":586,"column":17},"end":{"row":586,"column":18},"action":"insert","lines":["o"]}]}],[{"group":"doc","deltas":[{"start":{"row":586,"column":18},"end":{"row":586,"column":19},"action":"insert","lines":["d"]}]}],[{"group":"doc","deltas":[{"start":{"row":586,"column":19},"end":{"row":586,"column":20},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":586,"column":20},"end":{"row":586,"column":21},"action":"insert","lines":["l"]}]}],[{"group":"doc","deltas":[{"start":{"row":587,"column":45},"end":{"row":587,"column":52},"action":"remove","lines":["aterial"]},{"start":{"row":587,"column":45},"end":{"row":587,"column":46},"action":"insert","lines":["o"]}]}],[{"group":"doc","deltas":[{"start":{"row":587,"column":46},"end":{"row":587,"column":47},"action":"insert","lines":["d"]}]}],[{"group":"doc","deltas":[{"start":{"row":587,"column":47},"end":{"row":587,"column":48},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":587,"column":48},"end":{"row":587,"column":49},"action":"insert","lines":["l"]}]}],[{"group":"doc","deltas":[{"start":{"row":587,"column":59},"end":{"row":587,"column":66},"action":"remove","lines":["aterial"]},{"start":{"row":587,"column":59},"end":{"row":587,"column":60},"action":"insert","lines":["o"]}]}],[{"group":"doc","deltas":[{"start":{"row":587,"column":60},"end":{"row":587,"column":61},"action":"insert","lines":["d"]}]}],[{"group":"doc","deltas":[{"start":{"row":587,"column":61},"end":{"row":587,"column":62},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":587,"column":62},"end":{"row":587,"column":63},"action":"insert","lines":["l"]}]}],[{"group":"doc","deltas":[{"start":{"row":592,"column":9},"end":{"row":592,"column":16},"action":"remove","lines":["aterial"]},{"start":{"row":592,"column":9},"end":{"row":592,"column":10},"action":"insert","lines":["o"]}]}],[{"group":"doc","deltas":[{"start":{"row":592,"column":10},"end":{"row":592,"column":11},"action":"insert","lines":["d"]}]}],[{"group":"doc","deltas":[{"start":{"row":592,"column":11},"end":{"row":592,"column":12},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":592,"column":12},"end":{"row":592,"column":13},"action":"insert","lines":["l"]}]}]]},"ace":{"folds":[],"scrolltop":2117,"scrollleft":0,"selection":{"start":{"row":579,"column":25},"end":{"row":579,"column":25},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":63,"mode":"ace/mode/javascript"}},"timestamp":1426589372000,"hash":"edf94fc8b864b0322a9d7d0f06ac5eb4662fa2c4"}